(("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ant-design-pro"]=("undefined"!=typeof globalThis?globalThis:self)["makoChunk_ant-design-pro"]||[]).push([["7ce24c5c"],{cde098ae:function(e,s,a){a.d(s,"__esModule",{value:!0}),a.e(s,{default:function(){return N;}});var t=a("777fffbe"),l=a("852bbaa9"),r=a("452b4f57"),o=a("8946f00a"),c=l._(o),n=a("9f383c56"),i=t._(n),u=a("0e3da803"),d=t._(u),f=a("809b3261"),m=t._(f),g=a("2871fbcf"),h=t._(g),p=a("d800230b"),y=t._(p),x=a("8437ad0c"),S=a("92c451dd"),T=t._(S),k=a("d3c8d289"),j=t._(k),v=a("522048d4"),b=t._(v),L=a("2fba8039"),P=t._(L),w=a("27794ade");async function I(e){try{let s=await (0,w.request)("/api/user/list",{method:"GET",headers:{accept:"*/*"},params:{username:null==e?void 0:e.username,page:(null==e?void 0:e.current)?e.current-1:0,size:(null==e?void 0:e.pageSize)||10,sort:"createTime"}});if(!s.success&&200!==s.code)return{success:!1,code:s.code,message:s.message||"\u83B7\u53D6\u7528\u6237\u5217\u8868\u5931\u8D25"};{let e=s.data.content.map(e=>({id:e.id.toString(),username:e.username,userRootPath:e.userRootPath,storageType:e.accessStorageType,s3Link:"s3"===e.accessStorageType?e.accessStorageInfo:"",clientPublicKey:e.secretKey||"",createdAt:e.createTime}));return{success:!0,data:e,total:s.data.totalElements};}}catch(e){return console.error("\u83B7\u53D6\u7528\u6237\u5217\u8868\u5931\u8D25:",e),{success:!1,message:"\u83B7\u53D6\u7528\u6237\u5217\u8868\u5931\u8D25"};}}async function F(e){try{let s=await (0,w.request)("/api/user/create",{method:"POST",headers:{accept:"*/*","Content-Type":"application/json"},data:{username:e.username,passwd:e.passwd,userRootPath:e.userRootPath,accessStorageType:e.storageType,accessStorageInfo:e.s3Link||"",clientPublicKey:e.clientPublicKey||""}});if(s.success||200===s.code)return{success:!0,data:s.data};return{success:!1,code:s.code,message:s.message||"\u521B\u5EFA\u7528\u6237\u5931\u8D25"};}catch(e){return console.error("\u521B\u5EFA\u7528\u6237\u5931\u8D25:",e),{success:!1,message:"\u521B\u5EFA\u7528\u6237\u5931\u8D25"};}}async function C(e,s){try{let a=await (0,w.request)("/api/user/update",{method:"POST",headers:{accept:"*/*","Content-Type":"application/json"},data:{id:parseInt(e),username:s.username,passwd:s.passwd||"",userRootPath:s.userRootPath,accessStorageType:s.storageType,accessStorageInfo:"s3"===s.storageType?s.s3Link:"",secretKey:s.clientPublicKey||""}});if(a.success||200===a.code)return{success:!0,data:a.data};return{success:!1,code:a.code,message:a.message||"\u66F4\u65B0\u7528\u6237\u5931\u8D25"};}catch(e){return console.error("\u66F4\u65B0\u7528\u6237\u5931\u8D25:",e),{success:!1,message:"\u66F4\u65B0\u7528\u6237\u5931\u8D25"};}}async function _(e){try{let s=await (0,w.request)("/api/user/details",{method:"GET",headers:{accept:"*/*"},params:{id:e}});if(!s.success&&200!==s.code)return{success:!1,code:s.code,message:s.message||"\u83B7\u53D6\u7528\u6237\u8BE6\u60C5\u5931\u8D25"};{let e={id:s.data.id.toString(),username:s.data.username,userRootPath:s.data.userRootPath,storageType:s.data.accessStorageType,s3Link:"s3"===s.data.accessStorageType?s.data.accessStorageInfo:"",clientPublicKey:s.data.secretKey||"",createdAt:s.data.createTime};return{success:!0,data:e};}}catch(e){return console.error("\u83B7\u53D6\u7528\u6237\u8BE6\u60C5\u5931\u8D25:",e),{success:!1,message:"\u83B7\u53D6\u7528\u6237\u8BE6\u60C5\u5931\u8D25"};}}async function R(e){try{let s=await (0,w.request)("/api/user/remove",{method:"POST",headers:{accept:"*/*"},params:{id:e},data:""});if(s.success||200===s.code)return{success:!0,data:s.data};return{success:!1,code:s.code,message:s.message||"\u5220\u9664\u7528\u6237\u5931\u8D25"};}catch(e){return console.error("\u5220\u9664\u7528\u6237\u5931\u8D25:",e),{success:!1,message:"\u5220\u9664\u7528\u6237\u5931\u8D25"};}}var V=a("3c2c85c4"),K=t._(V),q=a("0c02d634"),E=t._(q),A=a("40e6751a"),O=t._(A),$=a("100b90d1"),z=t._($),B=a("b47c351f");let{Option:D}=O.default,G=(0,c.forwardRef)(({initialValues:e,onFinish:s,onCancel:a,formIdPrefix:t="user-form"},l)=>{let[o]=K.default.useForm(),[n,i]=(0,c.useState)([]),[u,d]=(0,c.useState)(!1);(0,c.useImperativeHandle)(l,()=>({resetFields:()=>o.resetFields(),setFieldsValue:e=>o.setFieldsValue(e)}));let f=async()=>{d(!0);try{let s=await (0,B.getS3Names)();if(s.success){let a=s.data.map(e=>({value:e.id.toString(),label:e.s3Name}));if(i(a),console.log("\u83B7\u53D6S3\u94FE\u63A5\u6210\u529F\uFF0C\u8FD4\u56DE\u6570\u636E:",s.data),console.log("\u8F6C\u6362\u540E\u7684S3\u94FE\u63A5\u9009\u9879:",a),e&&"s3"===e.storageType&&e.s3Link){if(console.log("\u68C0\u67E5initialValues\u4E2D\u7684s3Link\u503C:",e.s3Link),a.some(s=>s.value===e.s3Link.toString()))console.log("s3Link\u503C\u6709\u6548\uFF0C\u76F4\u63A5\u8BBE\u7F6E\u8868\u5355\u503C:",e),o.setFieldsValue(e);else{console.warn("s3Link\u503C\u4E0D\u5B58\u5728\u4E8ES3\u94FE\u63A5\u5217\u8868\u4E2D:",e.s3Link);let s=a.find(s=>s.label===e.s3Link||s.value===e.s3Link.toString()||s.value===e.s3Link);if(s){console.log("\u627E\u5230\u5339\u914D\u7684S3\u94FE\u63A5\uFF0CID:",s.value,"\u540D\u79F0:",s.label);let a={...e,s3Link:s.value};o.setFieldsValue(a),console.log("\u5DF2\u81EA\u52A8\u7EA0\u6B63\u5E76\u8BBE\u7F6Es3Link\u503C:",a);}else console.log("\u672A\u627E\u5230\u5339\u914D\u7684S3\u94FE\u63A5\uFF0C\u4F7F\u7528\u539F\u59CB\u503C:",e.s3Link),o.setFieldsValue(e);}}}else console.error("\u83B7\u53D6s3\u5B58\u50A8\u94FE\u63A5\u5931\u8D25:",s.message),i([]);}catch(e){console.error("\u83B7\u53D6s3\u5B58\u50A8\u94FE\u63A5\u5931\u8D25:",e),i([]);}finally{d(!1);}};return(0,c.useEffect)(()=>{if(e){console.log("initialValues\u53D1\u751F\u53D8\u5316:",e);let s={...e};"s3"===s.storageType&&s.s3Link?(console.log("\u68C0\u6D4B\u5230\u5B58\u50A8\u7C7B\u578B\u4E3As3\u4E14s3Link\u6709\u503C\uFF0C\u51C6\u5907\u83B7\u53D6S3\u94FE\u63A5\u5217\u8868..."),f()):(console.log("\u5B58\u50A8\u7C7B\u578B\u4E0D\u662Fs3\u6216s3Link\u6CA1\u6709\u503C\uFF0C\u76F4\u63A5\u8BBE\u7F6E\u8868\u5355\u503C:",s),o.setFieldsValue(s));}},[e,o]),(0,c.useEffect)(()=>{e||(o.resetFields(),console.log("\u8868\u5355\u5DF2\u91CD\u7F6E"));},[e,o]),(0,c.useEffect)(()=>{let s=o.getFieldValue("storageType")||(null==e?void 0:e.storageType);console.log("\u5B58\u50A8\u7C7B\u578B\u68C0\u67E5:",s),"s3"===s&&(console.log("\u5F00\u59CB\u83B7\u53D6S3\u94FE\u63A5..."),f());},[o]),(0,r.jsxs)(K.default,{form:o,layout:"vertical",initialValues:e,onFinish:a=>{s(a),e&&(o.resetFields(),console.log("\u7F16\u8F91\u63D0\u4EA4\u5B8C\u6210\uFF0C\u8868\u5355\u5DF2\u6E05\u7A7A"));},children:[e&&(0,r.jsx)(z.default,{message:"\u914D\u7F6E\u751F\u6548\u8BF4\u660E",description:"\u66F4\u65B0\u7684\u914D\u7F6E\u4FE1\u606F\u9700\u7528\u6237\u91CD\u65B0\u8FDE\u63A5SFTP\u670D\u52A1\u624D\u4F1A\u751F\u6548\uFF0C\u5B58\u91CF\u6B63\u5728\u8FDE\u63A5\u7684\u7528\u6237\u5C06\u7EE7\u7EED\u6309\u7167\u65E2\u5F80\u914D\u7F6E\u8FD0\u884C\u3002",type:"info",showIcon:!0,style:{marginBottom:16}}),(0,r.jsx)(K.default.Item,{name:"username",label:"\u7528\u6237\u540D",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"},{min:3,message:"\u7528\u6237\u540D\u957F\u5EA6\u81F3\u5C11\u4E3A3\u4F4D"}],children:(0,r.jsx)(E.default,{placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",id:`${t}-username`,disabled:!!e})}),(0,r.jsx)(K.default.Item,{name:"passwd",label:"\u5BC6\u7801",rules:[{validator:(s,a)=>a||e?a&&a.length<6?Promise.reject(Error("\u5BC6\u7801\u957F\u5EA6\u81F3\u5C11\u4E3A6\u4F4D")):Promise.resolve():Promise.reject(Error("\u8BF7\u8F93\u5165\u5BC6\u7801"))}],tooltip:"\u6DFB\u52A0\u7528\u6237\u65F6\u5FC5\u987B\u8F93\u5165\u5BC6\u7801\uFF0C\u7F16\u8F91\u7528\u6237\u65F6\u5BC6\u7801\u4E0D\u586B\u5199\u4E0D\u4F1A\u8986\u76D6\u539F\u5BC6\u7801",children:(0,r.jsx)(E.default.Password,{placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",id:`${t}-password`})}),(0,r.jsx)(K.default.Item,{name:"clientPublicKey",label:"\u5BA2\u6237\u7AEF\u516C\u94A5",tooltip:"\u7528\u4E8EAPI\u8C03\u7528\u8BA4\u8BC1\u7684\u5BA2\u6237\u7AEF\u516C\u94A5",children:(0,r.jsx)(E.default.TextArea,{rows:4,placeholder:"\u8BF7\u8F93\u5165\u5BA2\u6237\u7AEF\u516C\u94A5",id:`${t}-clientPublicKey`})}),(0,r.jsx)(K.default.Item,{name:"userRootPath",label:"\u7528\u6237\u6839\u76EE\u5F55",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u6839\u76EE\u5F55"}],tooltip:"\u8BF7\u4F7F\u7528\u5BF9\u5E94\u64CD\u4F5C\u7CFB\u7EDF\u7684\u8DEF\u5F84\u683C\u5F0F\uFF0Cs3\u5B58\u50A8\u6839\u76EE\u5F55\u4E3A\u7A7A\u53EF\u4EE5\u8BBE\u7F6E\u4E3A / ,\u5982\u679C\u5B58\u5728\u771F\u5B9E\u6839\u76EE\u5F55\u53EF\u4EE5\u8BBE\u7F6E dir/dir1/ \u5373\u53EF",children:(0,r.jsx)(E.default,{placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u6839\u76EE\u5F55\u8DEF\u5F84",id:`${t}-userRootPath`})}),(0,r.jsx)(K.default.Item,{name:"storageType",label:"\u5B58\u50A8\u7C7B\u578B",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u5B58\u50A8\u7C7B\u578B"}],children:(0,r.jsxs)(O.default,{placeholder:"\u8BF7\u9009\u62E9\u5B58\u50A8\u7C7B\u578B",onChange:e=>{console.log("\u5B58\u50A8\u7C7B\u578B\u53D8\u66F4\u4E3A:",e),"s3"===e?f():o.setFieldValue("s3Link",void 0);},children:[(0,r.jsx)(D,{value:"local",children:"\u672C\u5730\u6587\u4EF6"}),(0,r.jsx)(D,{value:"s3",children:"s3\u5B58\u50A8"})]})}),(0,r.jsx)(K.default.Item,{noStyle:!0,shouldUpdate:(e,s)=>e.storageType!==s.storageType,children:({getFieldValue:s})=>{let a=s("storageType");return console.log("\u5F53\u524D\u5B58\u50A8\u7C7B\u578B:",a),"s3"===a?(0,r.jsx)(K.default.Item,{name:"s3Link",label:"s3\u5B58\u50A8\u94FE\u63A5",rules:[{required:!0,message:"\u8BF7\u9009\u62E9s3\u5B58\u50A8\u94FE\u63A5"}],children:(0,r.jsxs)(O.default,{placeholder:"\u8BF7\u9009\u62E9s3\u5B58\u50A8\u94FE\u63A5",loading:u,onBlur:e=>{console.log("s3Link\u8F93\u5165\u6846\u5931\u7126\uFF0C\u5F53\u524D\u503C:",e);},showSearch:!0,filterOption:(e,s)=>(null==s?void 0:s.label.toLowerCase().includes(e.toLowerCase()))||(null==s?void 0:s.value.toString().includes(e)),maxTagCount:0,children:[n.map(e=>(0,r.jsx)(D,{value:e.value,children:e.label},e.value)),e&&e.s3Link&&!n.some(s=>s.value===e.s3Link.toString())&&(0,r.jsx)(D,{value:e.s3Link.toString(),children:`[\u{7CFB}\u{7EDF}\u{503C}] ${e.s3Link}`},"temp-option")]})}):null;}}),(0,r.jsx)(K.default.Item,{children:(0,r.jsxs)(y.default,{children:[(0,r.jsx)(h.default,{type:"primary",htmlType:"submit",children:e?"\u66F4\u65B0":"\u521B\u5EFA"}),(0,r.jsx)(h.default,{onClick:()=>{o.resetFields();},children:"\u91CD\u7F6E"}),(0,r.jsx)(h.default,{onClick:a,children:"\u53D6\u6D88"})]})})]});}),{confirm:H}=i.default,N=()=>{let[e,s]=(0,c.useState)([]),[a,t]=(0,c.useState)(!1),[l,o]=(0,c.useState)(!1),[n,u]=(0,c.useState)(!1),[f,g]=(0,c.useState)(null),[p,S]=(0,c.useState)(0),k=(0,c.useRef)(null),v=(0,c.useRef)(null),L=async e=>{t(!0);try{let a=await I(e);if(a.success)return s(a.data||[]),{data:a.data||[],total:a.total||0,success:!0};return d.default.error(a.message||"\u83B7\u53D6\u7528\u6237\u5217\u8868\u5931\u8D25"),{data:[],total:0,success:!1};}catch(e){return d.default.error("\u83B7\u53D6\u7528\u6237\u5217\u8868\u5931\u8D25"),{data:[],total:0,success:!1};}finally{t(!1);}},w=async e=>{try{let s=await F(e);s.success?(d.default.success("\u6DFB\u52A0\u7528\u6237\u6210\u529F"),o(!1),v.current&&v.current.resetFields(),k.current&&k.current.reload()):d.default.error(s.message||"\u6DFB\u52A0\u7528\u6237\u5931\u8D25");}catch(e){d.default.error("\u6DFB\u52A0\u7528\u6237\u5931\u8D25");}},V=async e=>{try{let s=await C(f.id,e);s.success?(d.default.success("\u7F16\u8F91\u7528\u6237\u6210\u529F"),u(!1),k.current&&k.current.reload()):d.default.error(s.message||"\u7F16\u8F91\u7528\u6237\u5931\u8D25");}catch(e){d.default.error("\u7F16\u8F91\u7528\u6237\u5931\u8D25");}},K=e=>{H({title:"\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u7528\u6237\u5417\uFF1F",icon:(0,r.jsx)(P.default,{}),onOk:()=>new Promise(async(s,a)=>{try{let t=await R(e);t.success?(d.default.success("\u5220\u9664\u7528\u6237\u6210\u529F"),k.current&&k.current.reload(),s(void 0)):(d.default.error(t.message||"\u5220\u9664\u7528\u6237\u5931\u8D25"),a(Error("\u5220\u9664\u5931\u8D25")));}catch(e){d.default.error("\u5220\u9664\u7528\u6237\u5931\u8D25"),a(e);}})});},q=async e=>{try{t(!0);let s=await _(e.id);s.success?(console.log("\u83B7\u53D6\u7528\u6237\u8BE6\u60C5\u6210\u529F:",s.data),g(s.data)):(d.default.error(s.message||"\u83B7\u53D6\u7528\u6237\u8BE6\u60C5\u5931\u8D25"),console.warn("\u4F7F\u7528\u5217\u8868\u4E2D\u7684\u7528\u6237\u6570\u636E\u4F5C\u4E3A\u56DE\u9000"),g(e)),u(!0);}catch(s){d.default.error("\u83B7\u53D6\u7528\u6237\u8BE6\u60C5\u5931\u8D25"),console.error("\u83B7\u53D6\u7528\u6237\u8BE6\u60C5\u5F02\u5E38:",s),g(e),u(!0);}finally{t(!1);}},E=[{title:"\u7528\u6237\u540D",dataIndex:"username",key:"username",valueType:"text",sorter:!0,hideInSearch:!1},{title:"\u7528\u6237\u6839\u76EE\u5F55",dataIndex:"userRootPath",key:"userRootPath",valueType:"text",hideInSearch:!0},{title:"\u5B58\u50A8\u7C7B\u578B",dataIndex:"storageType",key:"storageType",valueType:"select",valueEnum:{local:{text:"\u672C\u5730\u6587\u4EF6",status:"Default"},s3:{text:"s3\u5B58\u50A8",status:"Success"}},hideInSearch:!0},{title:"s3\u5B58\u50A8\u94FE\u63A5",dataIndex:"s3Link",key:"s3Link",valueType:"text",render:(e,s)=>"s3"===s.storageType?s.s3Link:"-",hideInSearch:!0},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createdAt",key:"createdAt",valueType:"dateTime",hideInSearch:!0},{title:"\u64CD\u4F5C",valueType:"option",render:(e,s)=>(0,r.jsxs)(y.default,{children:[(0,r.jsx)(h.default,{type:"link",icon:(0,r.jsx)(j.default,{}),onClick:()=>q(s),children:"\u7F16\u8F91"}),(0,r.jsx)(h.default,{type:"link",danger:!0,icon:(0,r.jsx)(b.default,{}),onClick:()=>K(s.id),children:"\u5220\u9664"})]})}];return(0,r.jsxs)("div",{children:[(0,r.jsx)(y.default,{style:{marginBottom:16},children:(0,r.jsx)(h.default,{type:"primary",icon:(0,r.jsx)(T.default,{}),onClick:()=>o(!0),children:"\u6DFB\u52A0\u7528\u6237"})}),(0,r.jsx)(x.ProTable,{columns:E,actionRef:k,request:L,rowKey:"id",loading:a,pagination:{pageSize:10},search:{labelWidth:"auto"},options:{setting:{listsHeight:400}}}),(0,r.jsx)(i.default,{title:"\u6DFB\u52A0\u7528\u6237",open:l,onCancel:()=>o(!1),footer:null,afterClose:()=>{v.current&&v.current.resetFields();},children:(0,r.jsx)(G,{ref:v,formIdPrefix:"create-user-form",onFinish:w,onCancel:()=>o(!1)})}),(0,r.jsx)(m.default,{title:"\u7F16\u8F91\u7528\u6237",width:720,placement:"right",onClose:()=>u(!1),open:n,children:f&&(0,r.jsx)(G,{formIdPrefix:"edit-user-form",initialValues:f,onFinish:V,onCancel:()=>u(!1)})})]});};}}]);
//# sourceMappingURL=7ce24c5c-async.efefa269.js.map